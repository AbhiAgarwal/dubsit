<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Dubsit</title>
    <link rel="stylesheet" href="{{ static_url("css/bootstrap.css") }}" type="text/css"/>
    <link rel="stylesheet" href="{{ static_url("css/template.css") }}" type="text/css"/>
    <link rel="stylesheet" href="{{ static_url("css/jquery.tagsinput.css") }}" type="text/css"/>
    <link rel="stylesheet" href="{{ static_url("css/least.min.css") }}" type="text/css"/>
  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="navbar-header"><a class="navbar-brand">Dubsit</a></div>
        <ul class="nav">
            <form role="form">
              <div class="form-group">
                <input class="tags" type="text" id="tags_1" value="gif" placeholder="Search">
              </div>
            </form>
        </ul>
    </div>
    <br><br>
    <div id="results"></div>
    <script src="{{ static_url("js/jquery-2.0.3.min.js") }}" type="text/javascript"></script>
    <script src="{{ static_url("js/jquery.tagsinput.js") }}"></script>
    <script src="{{ static_url("js/bootstrap.min.js") }}" type="text/javascript"></script>
    <script src="{{ static_url("js/least.min.js") }}" type="text/javascript"></script>
    <script src="{{ static_url("js/jquery.lazyload.min.js") }}" type="text/javascript"></script>
    <script src="{{ static_url("js/app.js") }}" type="text/javascript"></script>
    <script type="text/javascript">
      var search = []; // Search Array
      search.push('gif');
      var categories = ['web', 'image', 'gif'];
      // Analysis of either image, web or gif etc:
      function analysis(tag){
        if($.inArray(tag, categories) == 0){console.log(tag);}
        else{
          // 'web'
          if($.inArray(categories[0], search) != -1){ // == 0 means is present
            console.log('web');
          }
          // 'image'
          if($.inArray(categories[1], search) != -1){
            console.log('image');
          }
          // 'gif'
          if($.inArray(categories[2], search) != -1){
            $('#results').append('<div id="gif_division"><section id="id' + tag + '"><div id="h2' + tag + '"><h2>' + tag + '</h2></div><ul id=' + tag + '>');
            $.getJSON( "api/gif/giphy/model/" + tag + ".json", function(data){
              if($.isEmptyObject(data)){$("#h2" + tag).html('<h2>' + tag + ': Nothing found</h2>');}
              $.each(data, function(i, field){
                var html_img = '<li>';
                html_img += '<img data-original="' + field.media_url + '" src="' + field.media_url + '" width="240" height="150" />'
                html_img += '</li>'
                $("#" + tag).append(html_img);
              });
            });
            $('#results').append('</ul></section></div>');
            $("#" + tag).least();
            $("#h2" + tag).click(function(){
              $("#" + tag).toggle();
            });
          }
        }
      }
      // Adds Tag to Search
      function onAddTag(tag){
        if(typeof(tag) != 'undefined'){
          search.push(tag);
          if($.inArray(tag, categories) == -1){
            analysis(tag); 
          }
        }
      }
      // Remove Tag from Array
      function onRemoveTag(tag) {
        var index = search.indexOf(tag);
        if (search.length == 0){ 
          search = [];
          $('#results').remove(); 
          $('#h2' + tag).remove();
          $('#id' + tag).remove();
          $('#' + tag).remove();
        }
        if (search.length == 1){ 
          search = [];
          $('#h2' + tag).remove();
          $('#id' + tag).remove();
          $('#' + tag).remove();
        }
        else if (index > -1) { 
          $('#h2' + tag).remove();
          $('#id' + tag).remove();
          $('#' + tag).remove();
          search.splice(index, 1);
        }
      }
      // Supposed to find the Tag (Autocomplete)
      function onChange(tag){
        var languages = ['gif','image','web'];
        $('.tag', tag).each(function(){
          if($(this).text().search(new RegExp('\\b(' + languages.join('|') + ')\\b')) >= 0)
           $(this).css('background-color', 'yellow');
        });
      }
      // Initializes the Search Bar
      $(function() {
        $('#tags_1').tagsInput({
          width: 'auto',
          onRemoveTag: onRemoveTag,
          onAddTag: onAddTag,
          onChange: onChange,
        });                
      });  
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-39634458-3', 'dubsit.com');
      ga('send', 'pageview');
    </script>
  </body>
</html>